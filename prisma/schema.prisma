generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String           @id @default(cuid())
  email           String           @unique
  passwordHash    String
  name            String?
  isAdmin         Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  collegeRequests CollegeRequest[]
  courses         Course[]
  deadlines       Deadline[]
  excludedDates   ExcludedDate[]
  featureRequests FeatureRequest[]
  gpaEntries      GpaEntry[]
  issueReports    IssueReport[]
  notifications   Notification[]
  settings        Settings?
  tasks           Task[]

  @@index([email])
}

model Course {
  id            String         @id @default(cuid())
  userId        String
  code          String
  name          String
  term          String
  meetingTimes  Json           @default("[]")
  links         Json           @default("[]")
  colorTag      String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  startDate     DateTime?
  endDate       DateTime?
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  deadlines     Deadline[]
  excludedDates ExcludedDate[]
  gpaEntries    GpaEntry[]
  tasks         Task[]

  @@index([userId])
}

model Deadline {
  id        String    @id @default(cuid())
  userId    String
  title     String
  courseId  String?
  dueAt     DateTime?
  notes     String    @default("")
  status    String    @default("open")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  links     Json      @default("[]")
  course    Course?   @relation(fields: [courseId], references: [id])
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([courseId])
  @@index([status])
}

model Task {
  id        String    @id @default(cuid())
  userId    String
  title     String
  courseId  String?
  dueAt     DateTime?
  pinned    Boolean   @default(false)
  checklist Json      @default("[]")
  notes     String    @default("")
  status    String    @default("open")
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  links     Json      @default("[]")
  course    Course?   @relation(fields: [courseId], references: [id])
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([courseId])
  @@index([status])
  @@index([pinned])
}

model GpaEntry {
  id         String   @id @default(cuid())
  userId     String
  courseId   String?
  courseName String
  grade      String
  credits    Float
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  university String?
  course     Course?  @relation(fields: [courseId], references: [id])
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([university])
}

model Settings {
  id                  String   @id @default(cuid())
  userId              String   @unique
  dueSoonWindowDays   Int      @default(7)
  weekStartsOn        String   @default("Sun")
  theme               String   @default("system")
  enableNotifications Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  university          String?
  user                User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model CollegeRequest {
  id            String         @id @default(cuid())
  userId        String
  collegeName   String
  status        String         @default("pending")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  notifications Notification[]

  @@index([userId])
  @@index([status])
}

model IssueReport {
  id            String         @id @default(cuid())
  userId        String
  description   String         @db.Text
  status        String         @default("pending")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  notifications Notification[]

  @@index([userId])
  @@index([status])
}

model FeatureRequest {
  id            String         @id @default(cuid())
  userId        String
  description   String         @db.Text
  status        String         @default("pending")
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  notifications Notification[]

  @@index([userId])
  @@index([status])
}

model ExcludedDate {
  id          String   @id @default(cuid())
  userId      String
  courseId    String?
  date        DateTime
  description String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  course      Course?  @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([courseId])
  @@index([date])
}

model Notification {
  id                String         @id @default(cuid())
  userId            String
  title             String
  message           String
  type              String
  read              Boolean        @default(false)
  collegeRequestId  String?
  issueReportId     String?
  featureRequestId  String?
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt

  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  collegeRequest    CollegeRequest? @relation(fields: [collegeRequestId], references: [id], onDelete: Cascade)
  issueReport       IssueReport?   @relation(fields: [issueReportId], references: [id], onDelete: Cascade)
  featureRequest    FeatureRequest? @relation(fields: [featureRequestId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@index([collegeRequestId])
  @@index([issueReportId])
  @@index([featureRequestId])
}
